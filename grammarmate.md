# GrammarMate — Software Requirements Specification (SRS) / Техническое задание (ТЗ)
Версия: 0.2 (единый документ)  
Дата: 2026-01-03  

---

## 0. Пример структуры (как эталон оформления ТЗ)
1) Контекст, цель и границы  
2) Термины и определения  
3) Акторы и заинтересованные стороны  
4) Реестр юзкейсов (Gregg Larman)  
5) Fully Dressed юзкейсы (ключевые)  
6) Функциональные требования (FR)  
7) Требования к UI/UX  
8) Данные и форматы (CSV, хранение)  
9) Нефункциональные требования (NFR)  
10) События/звуки/метрики  
11) Ошибки и edge-cases  
12) Приложения (примеры CSV)

---

## 1. Контекст, цель и границы

### 1.1 Цель продукта
GrammarMate — тренажёр автоматизма перевода **с русского на целевой язык** (на старте: **английский и итальянский**) на основе **заранее подготовленного набора предложений**, строго выверенных по грамматическим паттернам.

Цель тренировки: пользователь должен переводить **максимум корректных предложений за минимальное активное время**.

### 1.2 Границы (что входит)
- Подача RU-предложений по урокам (темам/паттернам).
- Ввод ответа: **клавиатура** или **голос (STT)**.
- Проверка ответа по эталонным вариантам (включая альтернативы: do not / don’t и т.п.).
- Подсказка после **3 неправильных попыток** — показ эталонного перевода.
- Сессия тренировки с таймером активного времени, паузой и метрикой скорости (**⭐/мин**).
- Режимы тренировок:
  1) Один урок
  2) Все уроки последовательно
  3) Все уроки вперемешку (mixed/shuffle)
- **Управление уроками** через “служебный режим” (иконка шестерёнки):
  - импорт нового урока (CSV)
  - добавление/удаление урока
  - массовое удаление всех уроков
  - массовая загрузка набора уроков заново (reset/reload)
- Поддержка нескольких целевых языков:
  - предустановленные: English, Italian
  - опционально: пользователь может добавить новый целевой язык и импортировать к нему уроки

### 1.3 Что не входит (на текущем этапе)
- Машинный перевод “как переводчик” (нет генерации перевода).
- Обучающие объяснения грамматики/теории.
- Онлайн-аккаунты, серверная синхронизация, социальные функции (опционально позже).
- Перевод не с русского (PromptLanguage в MVP фиксируется RU).

---

## 2. Термины и определения

- **Урок (Lesson)** — тематическая/грамматическая подборка предложений (паттерн).
- **Карточка/предложение (Sentence Card)** — единица тренировки: RU-подсказка + набор допустимых целевых переводов.
- **Сессия (TrainingSession)** — непрерывный тренировочный проход с учётом активного времени и статистики.
- **Попытка (Attempt)** — один сабмит ответа пользователем на конкретную карточку.
- **Подсказка (Hint)** — показ эталонного перевода после достижения порога ошибок.
- **⭐/мин** — скорость корректного выполнения: число корректных ответов за минуту **активного** времени.

---

## 3. Акторы и заинтересованные стороны

### 3.1 Primary actor
- **Ученик (Learner)** — пользователь, который проходит тренировки.

### 3.2 Secondary actors / внешние системы
- **Speech-to-Text (STT) сервис** (например, Google Speech Services / Android Speech Recognizer) — преобразует аудио в текст.

### 3.3 Административный режим (тот же пользователь, иная роль)
- **Пользователь в служебном режиме (Content Manager mode)** — через иконку шестерёнки управляет языками и уроками локально.

---

## 4. Реестр юзкейсов (Use Case Registry, Gregg Larman)

Формат: **ID — Название — Цель — Primary Actor — Приоритет**

### Группа A — Тренировка (core)
- **UC-01 — Начать тренировочную сессию** — старт сессии в выбранном режиме — Learner — Must
- **UC-02 — Выбрать режим тренировки** (Урок / Все последовательно / Все mixed) — Learner — Must
- **UC-03 — Выбрать урок** — выбор темы/урока — Learner — Must
- **UC-04 — Пауза сессии** — остановка учёта активного времени — Learner — Must
- **UC-05 — Возобновить сессию** — продолжить учёт времени — Learner — Must
- **UC-06 — Завершить сессию** — завершение и фиксация статистики — Learner — Should

### Группа B — Ответ/проверка
- **UC-07 — Показать текущее предложение** — отображение RU-подсказки — System — Must
- **UC-08 — Ввести перевод текстом** — ввод строки — Learner — Must
- **UC-09 — Ввести перевод голосом** — STT → текст в поле — Learner — Must
- **UC-10 — Отправить ответ на проверку (Submit Attempt)** — создание Attempt и проверка — Learner — Must
- **UC-11 — Показать результат проверки** — верно/неверно, обновить счётчики — System — Must
- **UC-12 — Показать подсказку после 3 ошибок** — вывод эталона — System — Must
- **UC-13 — Перейти к следующему предложению** — навигация вперёд — Learner/System — Must
- **UC-14 — Перейти к предыдущему предложению** — навигация назад — Learner — Should

### Группа C — Метрики и прогресс
- **UC-15 — Отобразить метрики (таймер, ⭐/мин)** — realtime-показатели — System — Must
- **UC-16 — Сохранить прогресс** — сохранение позиции/статистики — System — Must
- **UC-17 — Восстановить прогресс** — продолжение после перезапуска — Learner/System — Should

### Группа D — Языки и уроки (служебный режим: шестерёнка)
- **UC-20 — Открыть служебный режим (шестерёнка)** — доступ к управлению данными — Learner — Must
- **UC-21 — Импортировать новый урок из CSV** — загрузка урока в выбранный язык — Content Manager mode — Must
- **UC-22 — Удалить урок** — удаление одного урока из коллекции языка — Content Manager mode — Must
- **UC-23 — Создать урок (пустой/черновик)** — создание оболочки урока (опционально) — Content Manager mode — Could
- **UC-24 — Удалить все уроки выбранного языка** — массовая операция — Content Manager mode — Must
- **UC-25 — Загрузить все уроки заново (Reset/Reload)** — очистить и импортировать набор уроков — Content Manager mode — Should
- **UC-26 — Выбрать целевой язык** (English / Italian / Custom) — Learner — Must
- **UC-27 — Добавить новый целевой язык** — создать запись языка и затем импортировать к нему уроки — Content Manager mode — Should
- **UC-28 — Удалить целевой язык** — удалить язык и все его уроки — Content Manager mode — Could

### Группа E — Звуковая обратная связь
- **UC-30 — Проиграть звук успеха** — короткий “ок” сигнал при верном ответе — System — Must
- **UC-31 — Проиграть звук ошибки** — короткий “ошибка” сигнал при неверном ответе — System — Must

---

## 5. Fully Dressed юзкейсы (ключевые, Ларман)

### UC-10 — Submit Attempt (Отправить ответ на проверку)
**Primary Actor:** Learner  
**Цель:** зафиксировать попытку перевода и получить результат (верно/неверно), обновить метрики/счётчики/подсказки.  
**Предусловия:**  
- Есть активная TrainingSession в состоянии **Active**.  
- Отображено текущее RU-предложение.  
- Поле ввода содержит текст (введённый вручную или через STT).  

**Гарантии успеха (postconditions) при завершении UC:**
- Создан Attempt с фиксацией raw/normalized текста, режима ввода, latency.
- Обновлены счётчики correct/incorrect в сессии.
- При необходимости показана подсказка и/или подготовлен переход к следующей карточке.
- Пересчитан показатель ⭐/мин.
- Проигран соответствующий звук (успех/ошибка).

**Основной сценарий (MSS):**
1. Пользователь нажимает кнопку **Проверить**.
2. Система фиксирует время реакции (latency) и создаёт Attempt.
3. Система нормализует ввод пользователя.
4. Система сравнивает нормализованный ввод со списком допустимых ответов текущей карточки.
5. Если ответ корректный:
   1) помечает Attempt как correct  
   2) увеличивает correctCount  
   3) проигрывает звук успеха  
6. Если ответ некорректный:
   1) помечает Attempt как incorrect  
   2) увеличивает incorrectCount и incorrectAttemptsForThisCard  
   3) проигрывает звук ошибки  
7. Если число некорректных попыток по карточке достигло 3 — система показывает подсказку (эталонный перевод).
8. Система обновляет UI: “Ваш ввод”, статус, метрики, и (по политике) предлагает переход вперёд.

**Расширения (Extensions):**
- **2a. Сессия в Paused:**  
  2a1. Система блокирует “Проверить” или показывает сообщение “Сначала возобновите сессию”. Attempt не создаётся.
- **3a. Пустой ввод:**  
  3a1. Кнопка “Проверить” неактивна; либо выводится сообщение “Введите перевод”.
- **7a. После подсказки:**  
  Политика MVP: **после показа подсказки карточка считается закрытой подсказкой и система предлагает перейти далее** (без бесконечных попыток).
- **4a. Несколько допустимых ответов:**  
  Если совпало с любым acceptedAnswer — ответ верный.

**Особые требования:**
- Время учитывается только в Active-состоянии (см. UC-04/05).
- Игнорировать пунктуацию согласно правилам нормализации (раздел 8).

**Технологические вариации:**
- Ввод текстом.
- Ввод голосом (STT) → затем пользователь подтверждает кнопкой “Проверить”.

---

### UC-04 — Пауза сессии
**Primary Actor:** Learner  
**Цель:** приостановить учёт активного времени, сохранив контекст текущей карточки.

**Предусловия:** SessionState = Active.  
**Постусловия:** SessionState = Paused, активный таймер остановлен, UI отражает паузу.

**MSS:**
1. Пользователь нажимает кнопку **Pause**.
2. Система фиксирует текущую точку времени и добавляет интервал в activeTime.
3. Система переводит сессию в состояние Paused.
4. Система обновляет UI: таймер не идёт, действия ответа блокированы (политика MVP).

---

### UC-21 — Импортировать новый урок из CSV
**Primary Actor:** Content Manager mode  
**Цель:** добавить в приложение новый урок (набор карточек) для выбранного целевого языка из CSV файла.

**Предусловия:**
- Пользователь открыл служебный режим (шестерёнка).
- Выбран целевой язык (English/Italian/Custom).
- Доступ к файлу CSV (локальное хранилище устройства).

**Постусловия (успех):**
- Создан (или обновлён) Lesson в выбранном языке.
- Созданы SentenceCards, каждая со списком acceptedAnswers.
- Урок становится доступным в режиме тренировки.

**MSS:**
1. Пользователь выбирает действие “Импорт урока (CSV)”.
2. Система открывает системный file picker.
3. Пользователь выбирает CSV файл.
4. Система читает CSV в UTF-8, валидирует формат.
5. Система создаёт урок и карточки, сохраняет их в локальное хранилище приложения.
6. Система показывает отчёт импорта: число строк, ошибок, добавленных карточек.

**Extensions:**
- **4a. Ошибка формата/кодировки:**  
  Система сообщает строку/причину, импорт не применяется или применяется частично по политике “all-or-nothing” (MVP: all-or-nothing).
- **5a. Дубликаты карточек:**  
  MVP: разрешить дубликаты; опционально — предупреждать.

---

### UC-26 — Выбрать целевой язык
**Primary Actor:** Learner  
**Цель:** переключить целевой язык тренировки (English / Italian / Custom).  
**MSS:**
1. Пользователь открывает выбор языка.
2. Выбирает язык.
3. Система загружает список уроков выбранного языка.
4. Система обновляет тренировочный экран (прогресс/наборы/режимы).

---

## 6. Функциональные требования (FR)

### 6.1 Тренировка и проверка
- **FR-01** Приложение должно показывать RU-предложение по одному за раз.
- **FR-02** Приложение должно принимать ответ через текстовый ввод и голосовой ввод (STT).
- **FR-03** Проверка ответа должна происходить только после явного действия “Проверить”.
- **FR-04** Приложение должно поддерживать несколько допустимых переводов для одной карточки.
- **FR-05** После 3 неверных попыток по одной карточке: показать подсказку (эталон/варианты).
- **FR-06** Должен вестись счёт правильных/неправильных ответов и активное время сессии.
- **FR-07** Должна вычисляться метрика **⭐/мин** на основе корректных ответов и активного времени.
- **FR-08** Должны быть режимы: урок / все последовательно / все mixed.
- **FR-09** Должна быть пауза, исключающая паузное время из active time.
- **FR-10** При верном ответе должен проигрываться звук успеха; при неверном — звук ошибки.

### 6.2 Языки
- **FR-20** Приложение должно поддерживать минимум два целевых языка: English и Italian.
- **FR-21** Должен быть механизм выбора активного целевого языка.
- **FR-22** (Опционально) Пользователь должен мочь добавить новый целевой язык по имени и импортировать к нему уроки.
- **FR-23** Уроки должны храниться раздельно по целевым языкам.

### 6.3 Управление уроками (служебный режим)
- **FR-30** Должна быть иконка шестерёнки, открывающая служебный режим.
- **FR-31** Должен поддерживаться импорт урока из CSV.
- **FR-32** Должно поддерживаться удаление одного урока.
- **FR-33** Должно поддерживаться массовое удаление всех уроков выбранного языка.
- **FR-34** Должна поддерживаться массовая перезагрузка (reset/reload) набора уроков (очистить + импортировать).
- **FR-35** (Опционально) Создание “пустого” урока без CSV допускается, но не обязательно для MVP.

### 6.4 Сохранение прогресса
- **FR-40** Приложение должно сохранять прогресс пользователя и статистику локально.
- **FR-41** Приложение должно восстанавливать последнее состояние после перезапуска (по политике: продолжить или начать заново).

---

## 7. Требования к UI/UX

### 7.1 Тренировочный экран (как в предоставленном UI)
Обязательные элементы:
- Заголовок/название приложения/режима.
- Прогресс: `N из M`.
- Таймер активного времени.
- Индикатор ⭐/мин.
- Три иконки режима (урок / все последовательно / mixed).
- RU-предложение крупным шрифтом.
- Поле ввода.
- Кнопка **Проверить**.
- Иконки микрофона и клавиатуры (быстрый выбор ввода).
- Стрелки навигации назад/вперёд.
- Кнопки управления сессией (play/pause/restart/stop); минимум — pause/resume.

Состояния:
- Active / Paused / AfterCheck / HintShown.

### 7.2 Служебный режим (шестерёнка)
Требования:
- Открывается отдельной иконкой “шестерёнка” на тренировочном экране.
- Отдельный экран/модалка с действиями:
  - Импорт урока (CSV)
  - Удалить урок (выбор из списка)
  - Удалить все уроки (подтверждение)
  - Reset/Reload (подтверждение + выбор набора файлов)
  - Управление языками (выбор/добавление/удаление — по доступности)
- Для опасных операций обязательны подтверждения (“Вы уверены?”).

---

## 8. Данные и форматы

### 8.1 CSV формат урока (карточки)
**Кодировка:** UTF-8  
**Разделитель полей:** `;` (точка с запятой)  
**Структура строки:**
- **Колонка 1:** RU предложение (prompt)
- **Колонка 2:** целевой перевод(ы) в одном поле, варианты разделяются знаком `+`

**Пример строки:**
- `Он не работает из дома;He doesn't work from home+He does not work from home`

**Правила:**
- Варианты в колонке 2 разделяются строго `+`.
- Пробелы вокруг `+` допускаются и должны игнорироваться при разборе.
- Каждая строка CSV соответствует одной SentenceCard.
- Пустые строки пропускаются.
- Строки без `;` считаются ошибочными.
- Кавычки вокруг полей допускаются (CSV-стандарт), но не обязательны.

### 8.2 Нормализация для проверки (важно)
Перед сравнением ответ пользователя и эталоны приводятся к normalized form.

**Обязательные правила нормализации:**
1. Trim пробелов по краям.
2. Схлопывание множественных пробелов в один.
3. Case-insensitive сравнение (в нижнем регистре).
4. Игнорировать пунктуацию, которую сложно “сказать на слух”, **но не ломать contractions**:
   - Удалять символы: `. , ? ! : ; " « » ( ) [ ] { }` и длинное тире `—` (при необходимости).
   - **Не удалять апостроф `'` внутри слова** (важно для don’t).
   - Дефис `-` сохранять (по умолчанию), т.к. встречается в составных словах; при необходимости можно сделать опцию.
5. Допускать эквивалентность множественных пробелов/табов.

**Примеры:**
- `Are you sure he will come?` ≈ `are you sure he will come`
- `He doesn't work from home!` ≈ `he doesn't work from home`
- `dont` НЕ равно `don't` (апостроф значим, иначе будет много ложных совпадений).

### 8.3 Хранение данных (предлагаемая структура)
Локальное хранилище приложения (без сервера).

**Сущности:**
- Language { id, displayName }
- Lesson { id, languageId, title, orderIndex, createdAt, updatedAt }
- SentenceCard { id, lessonId, promptRu, acceptedAnswers[] }
- TrainingSession { id, languageId, mode, state, activeTimeMs, startedAt, endedAt, stats... }
- Attempt { id, sessionId, sentenceId, rawInput, normalizedInput, inputMode, latencyMs, isCorrect, createdAt }

**Иерархия:**
- Language 1..* Lesson
- Lesson 1..* SentenceCard
- Session 1..* Attempt

---

## 9. Нефункциональные требования (NFR)

- **NFR-01** Приложение должно работать офлайн после загрузки уроков.
- **NFR-02** Время отклика проверки (после нажатия “Проверить”) — ≤ 150 мс для типичных строк (локальная проверка).
- **NFR-03** Импорт CSV должен валидироваться и давать понятный отчёт об ошибках (строка/причина).
- **NFR-04** Данные уроков и прогресс хранятся локально; приложение не отправляет их наружу без явного действия пользователя.
- **NFR-05** UI должен быть удобен на мобильных устройствах (touch targets, читаемость).
- **NFR-06** Доступ к микрофону запрашивается только при использовании голосового ввода.

---

## 10. Звуки, метрики, счёт

### 10.1 Звуки
- Успех: короткий “OK” (аналог Duolingo-like).
- Ошибка: короткий “error” сигнал.
- Звуки должны быть отключаемыми (настройка в будущем; в MVP можно использовать системную громкость и переключатель “Sound on/off”).

### 10.2 Метрики
- ActiveTime (с учётом пауз).
- CorrectCount / IncorrectCount.
- ⭐/мин = CorrectCount / (ActiveTimeMinutes)  
  где ActiveTimeMinutes = activeTimeMs / 60000.  
  Если ActiveTimeMinutes = 0, отображать 0 или “—”.

---

## 11. Ошибки и edge-cases (обязательные случаи)

- **E-01** Пользователь нажал “Проверить” при пустом поле — не создавать Attempt.
- **E-02** Пользователь на паузе пытается проверять — блокировать или просить “Resume”.
- **E-03** STT вернул пустую строку/ошибку — показать сообщение и не ломать сессию.
- **E-04** CSV содержит строки с пустым RU или пустым переводом — считать ошибкой импорта.
- **E-05** CSV содержит очень длинные строки — импортировать, но ограничить отображение; хранить полностью.
- **E-06** Mixed режим: при переключении языка/режима во время сессии — политика:
  - MVP: переключение режима/языка завершает текущую сессию и начинает новую (чётко фиксировать в реализации).

---

## 12. Приложение A — примеры CSV

### A.1 English (RU → EN)
```
"Он работает из дома";He works from home
"Он не работает из дома";He doesn't work from home+He does not work from home
"Ты уверен, что он придёт? Мы ждём больше часа";Are you sure he will come We have been waiting for more than an hour+Are you sure he'll come We have been waiting for over an hour
```

### A.2 Italian (RU → IT)
```
"Он работает из дома";Lavora da casa
"Он не работает из дома";Non lavora da casa
```

---

## 13. Примечание по дальнейшей работе по Ларману
Для реализации в первую очередь детализировать Fully Dressed:
- UC-01 Start Session
- UC-10 Submit Attempt
- UC-21 Import Lesson CSV
- UC-24 Delete All Lessons
- UC-26 Select Language
А затем для UC-10/UC-21 построить SSD (System Sequence Diagram) и список System Operations (API слоя приложения).

---

## 14. Актуализация требований (по итогам доработок)

### 14.1 Режимы ввода и голосовой цикл
- Приложение поддерживает два режима ввода: клавиатура и голос.
- В голосовом режиме распознавание запускается автоматически после успешной проверки и перехода к следующему предложению.
- После 3 ошибок по карточке показывается подсказка и повтор распознавания останавливается.
- Далее пользователь вручную запускает ввод (микрофон/клавиатура); при этом счетчик ошибок сбрасывается и снова доступны 3 попытки.
- При старте приложения сессия находится в Paused; запуск только по Play.
- При входе в настройки сессия автоматически ставится на паузу.
- В системном окне распознавания голосовой ввод показывает русский текст через prompt.

### 14.2 Управление сессией
- Pause: приостанавливает таймер активного времени.
- Play: возобновляет таймер и (в голосовом режиме) запускает распознавание.
- Stop: фиксирует рейтинг, сбрасывает таймер и статистику сессии.

### 14.3 CSV формат (актуально)
- Первая строка CSV — название урока (до 160 символов), читается до первого не-буквенно-цифрового символа.
- Далее идут строки карточек: `RU;Target1+Target2`.
- Кавычки вокруг полей игнорируются при парсинге.

### 14.4 Звуки
- Используются отдельные файлы звуков успеха и ошибки (duolingo-style).
- Звуки проигрываются через медиа-канал (как музыка).
- Системные звуки Google Speech Recognizer отключить программно нельзя.

### 14.5 UI
- Режимы тренировок отображаются иконками в одном ряду.
- В настройках добавлена инструкция по Play/Pause/Stop.

### 14.6 Поставка контента
- В APK нет встроенных уроков; контент загружается только через импорт CSV.
